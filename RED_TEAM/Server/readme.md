# Keylogging Malware Server

## 기능 요약

이 프로젝트는 여러 클라이언트로부터 키로깅 데이터를 수집하고 안전하게 저장하는 서버를 설계한 악성코드 시뮬레이션이다. 서버는 다음과 같은 주요 기능을 제공한다:

1. **암호화된 통신**: 서버는 RSA와 AES 암호화를 통해 클라이언트와 데이터를 안전하게 주고받는다.
2. **다중 클라이언트 지원**: 서버는 여러 클라이언트가 동시에 접속하여 데이터를 전송할 수 있도록 멀티스레드로 각 클라이언트를 개별적으로 처리한다.
3. **데이터베이스 저장**: 수신된 키로깅 데이터를 MariaDB에 저장하여 클라이언트별 키 입력 기록을 관리한다.
4. **실시간 상태 로그**: 서버는 클라이언트의 연결 상태와 데이터 수신 여부를 콘솔에 실시간으로 출력한다.



## 디렉토리 구성 및 파일 설명

```
Server/
├── __pycache__/                # 파이썬 바이트코드 캐시 디렉토리
├── Client.py                   # 클라이언트 코드: 서버에 암호화된 키로깅 데이터를 전송
├── init_db.sql                 # 데이터베이스 초기화 SQL 파일
├── ProtocolMessage.py          # 사용자 정의 프로토콜 메시지 처리 모듈
├── readme.md                   # 프로젝트 설명 문서
├── Server.py                   # 서버 코드: 클라이언트 데이터를 수신하고 DB에 저장
```

### 1. **Server.py**
- 서버의 메인 코드이다. 여러 클라이언트로부터 암호화된 키로깅 데이터를 수신하고 복호화하여 MariaDB에 저장한다.
- 클라이언트의 연결을 수락하고, 각 클라이언트를 독립적인 스레드로 개별 처리한다.
- RSA 및 AES 암호화를 수행하며, 수신된 데이터를 데이터베이스에 기록한다.
- 각 클라이언트에 대해 세션 ID를 생성하여 식별한다.

### 2. **Client.py**
- 서버에 데이터를 전송하는 클라이언트 코드이다.
- 서버로부터 RSA 공개키를 수신한 후, AES 키를 생성하고 이를 RSA로 암호화하여 서버에 전송한다.
- 키로깅 데이터를 AES로 암호화하여 서버에 전송하고, 서버의 응답을 수신한다.

### 3. **ProtocolMessage.py**
- 서버와 클라이언트 간의 안전한 데이터 전송을 위한 메시지 형식을 정의한 코드이다.
- 데이터 직렬화 및 역직렬화, AES 암호화 및 복호화 등을 처리한다.
- 요청 유형과 데이터 타입에 따른 메시지 포맷을 정의하고, 암호화된 페이로드를 안전하게 전송한다.

### 4. **init_db.sql**
- 데이터베이스 초기화를 위한 SQL 스크립트이다.
- `test`라는 데이터베이스와 `keylogs` 테이블을 생성하여 클라이언트로부터 수집된 키로깅 데이터를 저장한다.

  ```sql
  CREATE DATABASE IF NOT EXISTS test CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
  USE test;

  CREATE TABLE IF NOT EXISTS keylogs (
      id INT AUTO_INCREMENT PRIMARY KEY,
      session_id VARCHAR(8) NOT NULL,
      message TEXT,
      client_ip VARCHAR(45),
      client_port INT,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
  ```

  - **데이터베이스**: `test`
  - **테이블**: `keylogs`
    - `id` (INT): 기본 키
    - `session_id` (VARCHAR): 클라이언트 세션 ID
    - `message` (TEXT): 클라이언트의 키로깅 데이터
    - `client_ip` (VARCHAR): 클라이언트의 IP 주소
    - `client_port` (INT): 클라이언트의 포트
    - `created_at` (TIMESTAMP): 데이터가 저장된 시간

---

## 설치 및 설정 방법

### 1. 프로젝트 설정
1. 이 프로젝트를 로컬 머신에 클론하거나 다운로드한다.
2. `init_db.sql` 스크립트를 실행하여 데이터베이스와 `keylogs` 테이블을 초기화한다.

   ```bash
   mysql -u root -p < init_db.sql
   ```

   이 과정을 완료하면 `test`라는 데이터베이스가 생성되고, `keylogs` 테이블이 포함된다.

### 2. MariaDB 설치 및 설정
MariaDB를 설치해야 한다. 설치 방법은 운영 체제에 따라 다르며, [MariaDB 공식 문서](https://mariadb.org/download/)를 참조하여 MariaDB를 설치한다. 설치 후, MariaDB를 실행하고 데이터베이스와 테이블을 설정하기 위해 `init_db.sql` 파일을 실행한다.

```bash
# MariaDB에 접속
mysql -u root -p

# 데이터베이스 및 테이블 생성
source /path/to/init_db.sql;
```

이 과정이 완료되면 `test`라는 데이터베이스가 생성되고, `keylogs` 테이블이 포함된다.

### 3. 서버 실행
`Server.py` 파일이 있는 디렉토리에서 서버를 실행한다.

```bash
python Server.py
```

서버가 실행되면 다음과 같은 메시지가 출력된다:

```
Server running on localhost:12345
```

### 4. 클라이언트 실행
`Client.py` 파일을 실행하여 서버에 데이터를 전송한다.

```bash
python Client.py
```

서버는 클라이언트와 연결된 후 메시지를 수신하고, 받은 데이터를 처리하여 MariaDB에 저장한다.

### 5. 동시 클라이언트 연결
서버는 여러 클라이언트와 동시에 연결하여 데이터를 처리할 수 있다. 클라이언트가 여러 개의 세션을 통해 데이터를 전송하면, 서버는 이를 개별적으로 처리하고 응답을 보낸다.

---

## 코드 실행을 위한 환경 설정

### 1. Python 버전
이 코드는 Python 3.6 이상에서 실행된다. Python 버전을 확인하고 필요한 경우 최신 버전으로 업데이트한다.

```bash
python --version
```

### 2. 필요한 라이브러리 설치
필요한 라이브러리를 `requirements.txt` 파일을 통해 설치할 수 있다. `requirements.txt` 파일에 포함된 주요 라이브러리는 다음과 같다.

```txt
pycryptodome==3.10.1
cryptography==39.0.1
mysql-connector-python==8.0.29
```

라이브러리 설치는 다음과 같이 진행한다:

```bash
pip install -r requirements.txt
```

### 3. MariaDB 설정
MariaDB가 설치되어 있어야 하며, 데이터베이스와 테이블이 `init_db.sql`에 따라 설정되어 있어야 한다.

---

## 실행 예시

1. **서버 실행**:
    ```bash
    python Server.py
    ```

2. **클라이언트 실행**:
    ```bash
    python Client.py
    ```

3. **실행 예시 출력**

서버와 클라이언트를 실행했을 때의 출력 예시이다. 서버는 클라이언트의 연결 상태와 수신된 데이터를 콘솔에 표시하고, 각 클라이언트의 메시지를 식별하여 데이터베이스에 저장한다.

아래는 `keylogs` 테이블에서 키로깅 데이터가 제대로 저장된 예시를 보여주는 내용입니다. 이 예시는 설치 및 설정 문서에 포함되어 실제 데이터가 어떻게 저장되는지 확인하기 위해 추가되었다.

---

## 실행 예시

### 1. 서버 실행 예시
서버에서 클라이언트가 접속하고 데이터를 전송하는 모습을 보여준다.

```bash
PS C:\Users\woojin\Desktop\Malware\RED_TEAM\Server> python .\Server.py
Server running on localhost:12345
Client connected: ('127.0.0.1', 62912) (Session ID: 422e7561)
Client connected: ('127.0.0.1', 62914) (Session ID: 0ea08b86)
Client connected: ('127.0.0.1', 62916) (Session ID: ffba18e5)
Received keylog data from client ('127.0.0.1', 62914) (Session ID: 0ea08b86): hello1
Received keylog data from client ('127.0.0.1', 62916) (Session ID: ffba18e5): hello2
Received keylog data from client ('127.0.0.1', 62912) (Session ID: 422e7561): hello3
Received keylog data from client ('127.0.0.1', 62914) (Session ID: 0ea08b86): HELLO1
Received keylog data from client ('127.0.0.1', 62912) (Session ID: 422e7561): HELLO3
Received keylog data from client ('127.0.0.1', 62916) (Session ID: ffba18e5): HELLO2
Received keylog data from client ('127.0.0.1', 62914) (Session ID: 0ea08b86): test1
Received keylog data from client ('127.0.0.1', 62916) (Session ID: ffba18e5): test2
Received keylog data from client ('127.0.0.1', 62912) (Session ID: 422e7561): test3
Client disconnected: (Session ID: 422e7561)
Connection closed (Session ID: 422e7561)
Received keylog data from client ('127.0.0.1', 62916) (Session ID: ffba18e5): TEST2
Client disconnected: (Session ID: ffba18e5)
Connection closed (Session ID: ffba18e5)
Received keylog data from client ('127.0.0.1', 62914) (Session ID: 0ea08b86): TEST1
Received keylog data from client ('127.0.0.1', 62914) (Session ID: 0ea08b86): TERMINATE
Client disconnected: (Session ID: 0ea08b86)
Connection closed (Session ID: 0ea08b86)
```

### 2. 클라이언트 실행 예시
클라이언트에서 서버에 데이터를 전송하는 모습을 보여준다.

```bash
PS C:\Users\woojin\Desktop\Malware\RED_TEAM\Server> python .\Client.py
Enter message to send to server: hello1
Response from server: Data received from session 0ea08b86.
Enter message to send to server: HELLO1
Response from server: Data received from session 0ea08b86.
Enter message to send to server: test1
Response from server: Data received from session 0ea08b86.
Enter message to send to server: TEST1
Response from server: Data received from session 0ea08b86.
Enter message to send to server: TERMINATE
Response from server: Data received from session 0ea08b86.
```

### 3. MariaDB 데이터베이스에 저장된 키로깅 데이터
서버가 수집한 키로깅 데이터가 MariaDB `keylogs` 테이블에 저장된 모습을 보여준다.

```sql
MariaDB [test]> SELECT * FROM keylogs;
+----+------------+-----------+-----------+-------------+---------------------+
| id | session_id | message   | client_ip | client_port | created_at          |
+----+------------+-----------+-----------+-------------+---------------------+
| 35 | 0ea08b86   | hello1    | 127.0.0.1 |       62914 | 2024-11-15 02:58:27 |
| 36 | ffba18e5   | hello2    | 127.0.0.1 |       62916 | 2024-11-15 02:58:31 |
| 37 | 422e7561   | hello3    | 127.0.0.1 |       62912 | 2024-11-15 02:58:37 |
| 38 | 0ea08b86   | HELLO1    | 127.0.0.1 |       62914 | 2024-11-15 02:58:44 |
| 39 | 422e7561   | HELLO3    | 127.0.0.1 |       62912 | 2024-11-15 02:58:47 |
| 40 | ffba18e5   | HELLO2    | 127.0.0.1 |       62916 | 2024-11-15 02:58:55 |
| 41 | 0ea08b86   | test1     | 127.0.0.1 |       62914 | 2024-11-15 02:59:00 |
| 42 | ffba18e5   | test2     | 127.0.0.1 |       62916 | 2024-11-15 02:59:05 |
| 43 | 422e7561   | test3     | 127.0.0.1 |       62912 | 2024-11-15 02:59:08 |
| 44 | ffba18e5   | TEST2     | 127.0.0.1 |       62916 | 2024-11-15 02:59:19 |
| 45 | 0ea08b86   | TEST1     | 127.0.0.1 |       62914 | 2024-11-15 02:59:26 |
| 46 | 0ea08b86   | TERMINATE | 127.0.0.1 |       62914 | 2024-11-15 02:59:33 |
+----+------------+-----------+-----------+-------------+---------------------+
```

### 4. MariaDB 테이블 구조
`keylogs` 테이블의 구조는 다음과 같다. 각 키로깅 데이터에는 세션 ID, 클라이언트 IP 및 포트, 생성 시간 등이 포함되어 있다.

```sql
MariaDB [test]> DESCRIBE keylogs;
+-------------+-------------+------+-----+---------------------+----------------+
| Field       | Type        | Null | Key | Default             | Extra          |
+-------------+-------------+------+-----+---------------------+----------------+
| id          | int(11)     | NO   | PRI | NULL                | auto_increment |
| session_id  | varchar(8)  | NO   |     | NULL                |                |
| message     | text        | YES  |     | NULL                |                |
| client_ip   | varchar(45) | YES  |     | NULL                |                |
| client_port | int(11)     | YES  |     | NULL                |                |
| created_at  | timestamp   | YES  |     | current_timestamp() |                |
+-------------+-------------+------+-----+---------------------+----------------+
```

위 예시는 `keylogs` 테이블에 클라이언트의 키 입력 기록이 성공적으로 저장된 모습을 보여준다. 각 데이터에는 `session_id`와 `created_at` 필드가 포함되어 있어, 기록이 언제, 어떤 세션에서 수집되었는지 확인할 수 있다.

--- 

이 예시와 설명을 통해 데이터베이스에 저장된 내용을 명확하게 파악할 수 있다.

MIT License

Copyright (c) 2024 Brainoverflow

본 소프트웨어는 "있는 그대로" 제공되며, 명시적이든 묵시적이든 특정 목적에 대한 상업적 이용 가능성이나 비침해성, 특정 목적에 대한 적합성 등을 포함한 어떠한 형태의 보증도 제공하지 않습니다. 본 소프트웨어와 관련하여 발생하는 모든 손해에 대해 저작권자는 책임지지 않습니다.

1. 소프트웨어를 사용, 복제, 수정, 병합, 출판, 배포, 재라이선스, 또는 판매할 수 있는 권한을 부여합니다.
2. 소프트웨어의 복사본을 제공할 때 상기 저작권 공지와 허가 공지를 함께 제공해야 합니다.


