

# 📡 암호화 통신 프로토콜 (Encrypted Communication Protocol)

이 프로젝트는 AES와 RSA 암호화 방식을 활용하여 **클라이언트와 서버 간 안전한 데이터 통신**을 제공합니다. 클라이언트는 서버의 RSA 공개키로 AES 키를 암호화하여 전송하며, 이후 데이터는 AES를 통해 암호화하여 전송합니다. 본 프로토콜은 텍스트, 실행 파일, 이미지, 비디오 등 다양한 데이터 유형을 지원합니다.

## 🛠 기능 개요

- **안전한 키 교환**: AES 키를 RSA 암호화하여 전송
- **다양한 데이터 유형 지원**: 텍스트, 실행 파일, 이미지, 비디오, JSON 데이터 등
- **`ProtocolMessage` 클래스**: 직렬화, 암호화, 역직렬화 처리
- **서버와 클라이언트 구조**: RSA 공개 키 교환을 통한 AES 키 암호화/복호화
- **상태 기반 설계**: 난수 및 동적 상태를 활용한 보안 강화
- **헤더 난독화**: 패킷 구조와 데이터의 노출을 방지

## 📁 프로젝트 구조

📦 프로젝트 루트  
├── protocol_message.py   # ProtocolMessage 클래스 정의  
├── client.py             # 클라이언트 코드  
└── server.py             # 서버 코드  

## 🚀 설치

1. 의존성 설치
   ```bash
   pip install pycryptodome
   ```

2. 저장소 클론
   ```bash
   git clone <repository-url>
   cd <repository-name>
   ```

## 📋 사용법

1. 서버 시작
   ```bash
   python server.py
   ```

2. 클라이언트에서 데이터 전송

   - 텍스트 전송
     ```python
     send_data_to_server(text="Hello, this is a test message")
     ```

   - 파일 전송
     ```python
     send_data_to_server(file_path="path/to/your/file", request_type="EXECUTABLE")
     ```

## 🔍 보안 설계

### **1. AES 및 RSA 암호화 흐름**
- **AES 암호화**: 대칭 키 암호화 방식으로, 데이터 전송 과정에서 빠르고 효율적인 암호화를 수행합니다.
- **RSA 암호화**: 비대칭 키 암호화 방식으로, AES 대칭 키를 안전하게 교환합니다.
- **랜덤 패딩 및 데이터 삽입**: 암호화된 데이터에 추가적인 무작위성을 삽입하여 데이터 패턴 분석을 방지합니다.

### **2. 데이터 난독화 방지 기법**

#### **2.1 패딩(Padding)**
- 모든 데이터 패킷은 고정된 크기를 유지하도록 랜덤 데이터를 추가하여 패킷 길이를 일정하게 만듭니다.
- 암호화된 데이터와 실제 데이터 간의 경계를 숨김으로써 데이터의 노출 위험을 줄입니다.

#### **2.2 XOR 연산을 이용한 변형**
- 데이터를 전송하기 전에 임의의 XOR 키를 적용하여 원본 데이터의 패턴을 감춥니다.
- 복호화 과정에서는 동일한 XOR 키를 사용하여 원본 데이터를 복구합니다.

#### **2.3 가짜 데이터 삽입**
- 실제 데이터 사이에 무작위로 생성된 가짜 데이터를 삽입하여 데이터의 구조를 복잡하게 만듭니다.
- 가짜 데이터를 필터링하기 위한 별도의 메타데이터를 포함합니다.

### **3. 헤더 난독화**
- 암호화된 헤더 데이터를 **AES GCM** 모드로 암호화하여 무결성을 검증합니다.
- 데이터 내부에 임의의 해시값 및 시그니처를 추가하여 헤더 변조를 방지합니다.
- 요청 유형(Request Type)과 데이터 유형(Data Type) 정보를 난수 기반 값으로 동적으로 변환하여 분석 가능성을 차단합니다.

### **4. 네트워크 트래픽 보호**
- 모든 데이터 패킷은 고유한 세션 ID를 포함하여 요청을 식별하며, 이를 통해 **중간자 공격**(MITM)을 방지합니다.
- TLS/SSL 기반 암호화 채널을 추가로 사용하여 네트워크 전송 중 데이터 가로채기 방지.

### **5. 암호화 및 난독화 개선 기법**
- **멀티레이어 암호화**: 데이터는 AES로 암호화된 후 추가적으로 RSA 키로 암호화되어 두 가지 보안 레이어를 제공합니다.
- **다양한 난수 생성기 사용**: 안전한 키와 데이터 변환을 위해 OS 기반 안전한 난수 생성기를 사용합니다.
- **상태 기반 데이터 변환**: 현재의 동적 상태(State)에 따라 데이터를 변환하여 분석 가능성을 낮춥니다.

### **6. 데이터 무결성 검증**
- **GCM (Galois/Counter Mode)**: AES 암호화에 GCM 모드를 사용하여 암호화와 함께 인증 태그를 생성, 데이터 변조를 탐지.
- **해시 기반 서명**: SHA256과 같은 해시 알고리즘을 사용해 데이터의 무결성을 보장.


## 💡 핵심 코드 설명

### ProtocolMessage 클래스

`ProtocolMessage` 클래스는 데이터 직렬화, 암호화, 복호화에 필요한 핵심 기능을 수행합니다.

- 생성자
  ```python
  def __init__(self, session_id, request_type, data_type, payload):
      self.session_id = session_id
      self.request_type = request_type
      self.data_type = data_type
      self.payload = payload
      self.key = ProtocolMessage.shared_key  # 공유된 AES 키 사용
  ```

- AES 암호화
  ```python
  def encrypt_payload(self):
      cipher = AES.new(self.key, AES.MODE_GCM)
      ciphertext, tag = cipher.encrypt_and_digest(self.payload)
      return cipher.nonce, ciphertext, tag
  ```

- 직렬화
  ```python
  def serialize(self):
      # 암호화된 페이로드와 메타데이터를 직렬화하여 전송 가능한 바이트 형태로 변환
  ```

- 헤더 난독화 및 추가 데이터
  ```python
  def generate_dynamic_header(self, ciphertext):
      # 헤더 생성 시 난수 기반 데이터 및 추가 가짜 데이터를 삽입하여 난독화
  ```

## 📜 라이선스

MIT 라이선스 하에 배포됩니다.

## 🤝 기여

1. 이 저장소를 포크합니다.
2. 새로운 기능에 대한 브랜치를 생성합니다.
   ```bash
   git checkout -b feature/AmazingFeature
   ```
3. 변경 사항을 커밋합니다.
   ```bash
   git commit -m 'Add some AmazingFeature'
   ```
4. 브랜치에 푸시합니다.
   ```bash
   git push origin feature/AmazingFeature
   ```
5. Pull Request를 엽니다.

## 📝 고려 사항

- **공개 키 난독화**: RSA 공개 키 설정 과정이 패킷에서 노출될 수 있으므로 이를 인코딩하여 보완
- **추가 패딩 및 위장 데이터 삽입**: 데이터 구조를 불규칙화하여 분석 및 공격을 어렵게 만듦
